
USE_OCAMLFIND = true
NATIVE_ENABLED = true
BYTE_ENABLED = true

.PHONY: clean

OCAMLOPTFLAGS += -g -inline 100

.SUBDIRS: src/libs/ocaml-leveldb src/libs/extprot

OCAMLCFLAGS += -g
OCAMLFLAGS += -annot -thread
OCAMLFINDFLAGS += -syntax camlp4o

OCAMLPACKS[] = batteries lwt lwt.unix lwt.syntax lwt.preemptive

LD_PATHS[] =
	$(ROOT)/src/libs/ocaml-leveldb/src
	$(ROOT)/src

setenv(CAML_LD_LIBRARY_PATH, $(concat :, $(absname $(LD_PATHS))))

.SUBDIRS: src test

foreach(exec, obigstore ob_dump ob_load ob_repl)
    $(exec): src/$(exec)$(EXE)
        ln-or-cp $< $@

.DEFAULT: obigstore ob_dump ob_load ob_repl

clean:
	rm -f $(filter-proper-targets $(ls R, .))
